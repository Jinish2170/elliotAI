---
phase: 10-cybersecurity-deep-dive
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - veritas/analysis/security/owasp/__init__.py
  - veritas/analysis/security/owasp/a01_broken_access_control.py
  - veritas/analysis/security/owasp/a02_cryptographic_failures.py
  - veritas/analysis/security/owasp/a03_injection.py
  - veritas/analysis/security/owasp/a04_insecure_design.py
  - veritas/analysis/security/owasp/a05_security_misconfiguration.py
  - veritas/analysis/security/owasp/a06_vulnerable_components.py
  - veritas/analysis/security/owasp/a07_authentication_failures.py
  - veritas/analysis/security/owasp/a08_data_integrity.py
  - veritas/analysis/security/owasp/a09_logging_failures.py
  - veritas/analysis/security/owasp/a10_ssrf.py
autonomous: true
requirements:
  - SEC-01
user_setup: []

must_haves:
  truths:
    - All 10 OWASP Top 2021 modules extend SecurityModule base class from 10-01
    - Modules are assigned to appropriate tiers (MEDIUM or DEEP based on complexity)
    - Each module analyzes DOM metadata from Scout for vulnerability detection
    - Findings include CWE ID mapping via CWEMapper from Phase 9
    - CVSS scores calculated using CVSSCalculator from Phase 9
  artifacts:
    - path: veritas/analysis/security/owasp/a01_broken_access_control.py
      provides: OWASP A01 detection (admin panels, IDOR)
      tier: DEEP
      exports: ["BrokenAccessControlModule"]
    - path: veritas/analysis/security/owasp/a02_cryptographic_failures.py
      provides: OWASP A02 detection (weak encryption, outdated TLS)
      tier: MEDIUM
      exports: ["CryptographicFailuresModule"]
    - path: veritas/analysis/security/owasp/a03_injection.py
      provides: OWASP A03 detection (SQL injection, XSS, command injection)
      tier: MEDIUM
      exports: ["InjectionModule"]
    - path: veritas/analysis/security/owasp/a04_insecure_design.py
      provides: OWASP A04 detection (mass assignment, business logic flaws)
      tier: DEEP
      exports: ["InsecureDesignModule"]
    - path: veritas/analysis/security/owasp/a05_security_misconfiguration.py
      provides: OWASP A05 detection (debug mode, default credentials, error messages)
      tier: MEDIUM
      exports: ["SecurityMisconfigurationModule"]
    - path: veritas/analysis/security/owasp/a06_vulnerable_components.py
      provides: OWASP A06 detection (outdated libraries, known CVEs)
      tier: MEDIUM
      exports: ["VulnerableComponentsModule"]
    - path: veritas/analysis/security/owasp/a07_authentication_failures.py
      provides: OWASP A07 detection (weak passwords, session management)
      tier: DEEP
      exports: ["AuthenticationFailuresModule"]
    - path: veritas/analysis/security/owasp/a08_data_integrity.py
      provides: OWASP A08 detection (insecure deserialization, software integrity)
      tier: MEDIUM
      exports: ["DataIntegrityFailuresModule"]
    - path: veritas/analysis/security/owasp/a09_logging_failures.py
      provides: OWASP A09 detection (missing security logging, audit trails)
      tier: MEDIUM
      exports: ["LoggingFailuresModule"]
    - path: veritas/analysis/security/owasp/a10_ssrf.py
      provides: OWASP A10 detection (SSRF in URLs, file:// protocol)
      tier: MEDIUM
      exports: ["SSRFModule"]
    - path: veritas/analysis/security/owasp/__init__.py
      provides: OWASP module exports
      exports: ["BrokenAccessControlModule", "CryptographicFailuresModule", "InjectionModule"]
  key_links:
    - from: veritas/analysis/security/owasp/*.py
      to: veritas/analysis/security/base.py
      via: import SecurityModule
      pattern: "from ..base import SecurityModule"
    - from: veritas/analysis/security/owasp/*.py
      to: veritas/config/security_rules.py
      via: import cwemapper
      pattern: "from config.security_rules import cwemapper"
    - from: veritas/analysis/security/owasp/a03_injection.py
      to: veritas/analysis/dom_analyzer.py
      via: import DOMAnalyzer
      pattern: "from analysis.dom_analyzer import DOMAnalyzer"
---

<objective>
Implement 10 OWASP Top 2021 security modules (A01-A10) with tier-based execution, DOM metadata analysis, CWE ID mapping, and CVSS scoring integration.

Purpose: Provide comprehensive OWASP Top 10 vulnerability coverage by implementing detection modules that analyze DOM metadata, HTTP headers, and page content for vulnerabilities, mapped to CWE IDs with CVSS severity scoring.

Output: 10 OWASP security modules covering A01-A10, each extending SecurityModule with category_id="owasp_a01" through "owasp_a10", tier assignments (MEDIUM or DEEP), and findings with CWE ID mapping.
</objective>

<execution_context>
@C:/Users/hp/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/hp/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-cybersecurity-deep-dive/10-RESEARCH.md
@.planning/phases/10-cybersecurity-deep-dive/10-01-PLAN.md
@veritas/analysis/security/base.py
@veritas/analysis/dom_analyzer.py
@veritas/cwe/registry.py
@veritas/cwe/cvss_calculator.py

# Existing DOM analysis infrastructure

From veritas/analysis/dom_analyzer.py ( ScoutResult provides DOM metadata):
```python
class DOMAnalyzer:
    def analyze(self, html: str, url: str) -> DOMResult
    # Extracts: admin_panel, forms, scripts, iframes, meta_tags, etc.

class DOMResult:
    dom_depth: int
    dom_node_count: int
    scripts: List[dict]  # {src, content, inline}
    forms: List[dict]    # {action, method, inputs, has_password}
    admin_panel: Optional[dict]
    idor_patterns: List[str]
```

# OWASP CWE mappings (from Phase 9)

From veritas/cwe/registry.py, key CWEs to map:
- A01 Broken Access Control: CWE-285 (Improper Auth), CWE-639 (IDOR)
- A02 Cryptographic: CWE-327 (Use Broken Crypto), CWE-319 (Cleartext Transmission)
- A03 Injection: CWE-79 (XSS), CWE-89 (SQLi), CWE-78 (Command Injection)
- A04 Insecure Design: CWE-862 (Missing Auth), CWE-913 (Business Logic)
- A05 Misconfig: CWE-2 (Buffer Error), CWE-209 (Error Messages)
- A06 Vuln Components: CWE-937 (Vuln Components)
- A07 Auth Failures: CWE-287 (Improper Auth), CWE-307 (Unprotected Redirect)
- A08 Data Integrity: CWE-502 (Deserialization), CWE-494 (Integrity)
- A09 Logging: CWE-778 (Insufficient Logging)
- A10 SSRF: CWE-918 (SSRF)
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement OWASP A01-A03 modules (Access Control, Cryptographic, Injection)</name>
  <files>veritas/analysis/security/owasp/a01_broken_access_control.py, veritas/analysis/security/owasp/a02_cryptographic_failures.py, veritas/analysis/security/owasp/a03_injection.py</files>
  <action>
    Create 3 OWASP modules in owasp/ directory:

    1. a01_broken_access_control.py:
       - Module: BrokenAccessControlModule
       - Tier: DEEP, timeout: 20
       - Category: owasp_a01
       - Analyze dom_meta for:
         * admin_panel exists without requires_role flag (CWE-285, critical)
         * idor_patterns list (sequential IDs exposed like /users/123) (CWE-639, high)
         * Path traversal indicators: ../, %2e%2e, path= in URLs (CWE-22, high)
         * Unrestricted file uploads (multipart/form-data without validation) (CWE-434, high)
       - Use cwemapper.map_finding_to_cwe("owasp_a01", pattern_type) for mapping

    2. a02_cryptographic_failures.py:
       - Module: CryptographicFailuresModule
       - Tier: MEDIUM, timeout: 10
       - Category: owasp_a02
       - Analyze headers and page_content for:
         * Missing HTTPS on forms with password fields (CWE-319, critical)
         * Weak TLS version (< TLS 1.2) in headers (CWE-327, high)
         * Weak cipher suites in SSL (RC4, MD5) (CWE-327, medium)
         * Hardcoded secrets in page_content (password=, api_key=, secret=) (CWE-312, high)
         * Missing HSTS header (already in A05, but check here too) (medium)

    3. a03_injection.py:
       - Module: InjectionModule
       - Tier: MEDIUM, timeout: 10
       - Category: owasp_a03
       - Analyze dom_meta (DOMAnalyzer) for:
         * XSS vectors: innerHTML=, eval(, document.write (CWE-79, high)
         * SQL injection patterns in URL query strings: OR 1=1, ' OR '1'='1, UNION SELECT (CWE-89, critical)
         * Command injection: ;, &&, |, exec(, system( in params (CWE-78, critical)
         * Template injection: {{, {% in page_content (CWE-94, high)
         * LDAP injection patterns: (uid=* in params (CWE-90, medium)
       - Use DOMAnalyzer script/form extraction for DOM-based injection detection

    All modules must:
   - Extend SecurityModule from ..base
   - Set category_id property
   - Use cwemapper from config.security_rules for CWE ID mapping
   - Return List[SecurityFinding] with cwe_id populated
  </action>
  <verify>
    <automated>python -c "from veritas.analysis.security.owasp.a01_broken_access_control import BrokenAccessControlModule; from veritas.analysis.security.owasp.a02_cryptographic_failures import CryptographicFailuresModule; from veritas.analysis.security.owasp.a03_injection import InjectionModule; print('A01, A02, A03 modules import successfully')"</automated>
  </verify>
  <done>OWASP A01, A02, A03 modules implemented with tier assignment, CWE ID mapping, and DOM metadata analysis</done>
</task>

<task type="auto">
  <name>Task 2: Implement OWASP A04-A06 modules (Insecure Design, Misconfiguration, Vulnerable Components)</name>
  <files>veritas/analysis/security/owasp/a04_insecure_design.py, veritas/analysis/security/owasp/a05_security_misconfiguration.py, veritas/analysis/security/owasp/a06_vulnerable_components.py</files>
  <action>
    Create 3 OWASP modules:

    1. a04_insecure_design.py:
       - Module: InsecureDesignModule
       - Tier: DEEP, timeout: 15
       - Category: owasp_a04
       - Analyze dom_meta for:
         * Mass assignment: forms with unchecked multiple fields (CWE-915, medium)
         * Business logic flaws: race conditions (no CSRF token on state-changing forms) (CWE-352, high)
         * Missing rate limiting indicators (no captcha on login) (CWE-307, medium)
         * Improper isolation: customer data in admin URLs (CWE-13, high)
         * Sensitive data in URL params: ?email=, ?password= (CWE-598, high)

    2. a05_security_misconfiguration.py:
       - Module: SecurityMisconfigurationModule
       - Tier: MEDIUM, timeout: 8
       - Category: owasp_a05
       - Analyze headers and page_content for:
         * Debug mode enabled: X-Debug: true, debug=true in URL (CWE-489, high)
         * Default credentials: admin/admin, root/1234 in comments (CWE-798, critical)
         * Stack traces in error messages: Traceback, Exception in response (CWE-209, medium)
         * Directory listing enabled (index of /folder) (CWE-538, medium)
         * CORS misconfiguration: Access-Control-Allow-Origin: * with credentials (CWE-942, medium)

    3. a06_vulnerable_components.py:
       - Module: VulnerableComponentsModule
       - Tier: MEDIUM, timeout: 10
       - Category: owasp_a06
       - Analyze page_content for:
         * Outdated library versions:
           - jQuery < 3.5.0 (CWE-937, high)
           - Bootstrap < 4.5.0 (medium)
           - React < 16.9.0 (medium)
           - AngularJS < 1.7.0 (medium)
         * Known CVE patterns in library names (check version strings)
         * Content-Type: multipart/form-data without validation (CWE-434, high)
         * npm audit indicators: package-lock.json exposed (low)

    All modules:
   - Extend SecurityModule
   - Use cwemapper for CWE mapping
   - Parse script tags for library version detection
   - Check form attributes for CSRF tokens
  </action>
  <verify>
    <automated>python -c "from veritas.analysis.security.owasp.a04_insecure_design import InsecureDesignModule; from veritas.analysis.security.owasp.a05_security_misconfiguration import SecurityMisconfigurationModule; from veritas.analysis.security.owasp.a06_vulnerable_components import VulnerableComponentsModule; print('A04, A05, A06 modules import successfully')"</automated>
  </verify>
  <done>OWASP A04, A05, A06 modules implemented with tier assignment, CWE ID mapping, and library version detection</done>
</task>

<task type="auto">
  <name>Task 3: Implement OWASP A07-A10 modules (Authentication, Data Integrity, Logging, SSRF)</name>
  <files>veritas/analysis/security/owasp/a07_authentication_failures.py, veritas/analysis/security/owasp/a08_data_integrity.py, veritas/analysis/security/owasp/a09_logging_failures.py, veritas/analysis/security/owasp/a10_ssrf.py</files>
  <action>
    Create 4 OWASP modules:

    1. a07_authentication_failures.py:
       - Module: AuthenticationFailuresModule
       - Tier: DEEP, timeout: 15
       - Category: owasp_a07
       - Analyze dom_meta and page_content for:
         * Password fields without autocomplete=off (CWE-522, low)
         * Password constraints missing (no minlength, pattern) (CWE-521, medium)
         * Session fixation: session ID in URL (CWE-384, high)
         * Unprotected redirects: forms with action=external without CSRF (CWE-601, high)
         * Password recovery without secondary verification: secret question only (CWE-640, medium)
         * Missing CAPTCHA on login: no recaptcha, hCaptcha visible (CWE-795, medium)

    2. a08_data_integrity.py:
       - Module: DataIntegrityFailuresModule
       - Tier: MEDIUM, timeout: 10
       - Category: owasp_a08
       - Analyze page_content for:
         * Insecure deserialization: pickle.loads, eval(base64, yaml.load (CWE-502, critical)
         * Unverified dependencies: CDN links without integrity attribute (CWE-494, medium)
         * Subresource Integrity missing on script tags: <script src="https://cdn..."> without integrity (CWE-494, medium)
         * Package tampering indicators: checksum validation missing (low)
         * Software supply chain risk: npm unpkg.com, jsdelivr.com usage (low)

    3. a09_logging_failures.py:
       - Module: LoggingFailuresModule
       - Tier: MEDIUM, timeout: 8
       - Category: owasp_a09
       - Analyze page_content for:
         * Missing security logging indicators: no audit logs visible in errors (CWE-778, low)
         * Sensitive data in logs: passwords, tokens in console.log (CWE-532, medium)
         * Insufficient log retention clues: no audit trail elements (low)
         * No intrusion detection: no rate limiting headers (low)
         * Debug information leaked: console.log(app), console.log(DEBUG) (medium)

    4. a10_ssrf.py:
       - Module: SSRFModule
       - Tier: MEDIUM, timeout: 10
       - Category: owasp_a10
       - Analyze dom_meta (forms, links) for:
         * SSRF in URLs: url=, endpoint=, target= params (CWE-918, critical)
         * file:// protocol in URLs: file:///, file:/etc/ (CWE-918, high)
         * Internal network indicators: localhost, 127.0.0.1, 192.168., 10. (CWE-918, high)
         * Cloud metadata endpoints: 169.254.169.254 (AWS), metadata.google.internal (GCP) (CWE-918, critical)
         * DNS rebinding indicators: hostname in query strings (medium)

    All modules:
   - Extend SecurityModule
   - Use dom_meta for form and script analysis
   - Use page_content for pattern matching
   - Return findings with CWE ID mapping
  </action>
  <verify>
    <automated>python -c "from veritas.analysis.security.owasp.a07_authentication_failures import AuthenticationFailuresModule; from veritas.analysis.security.owasp.a08_data_integrity import DataIntegrityFailuresModule; from veritas.analysis.security.owasp.a09_logging_failures import LoggingFailuresModule; from veritas.analysis.security.owasp.a10_ssrf import SSRFModule; print('A07, A08, A09, A10 modules import successfully')"</automated>
  </verify>
  <done>OWASP A07, A08, A09, A10 modules implemented with tier assignment, CWE ID mapping, and form/script analysis</done>
</task>

</tasks>

<verification>
All 10 OWASP modules (A01-A10) auto-discoverable via get_all_security_modules(), each module extends SecurityModule base class, CWE IDs mapped via CWEMapper, tier grouping shows 5 MEDIUM and 5 DEEP modules
</verification>

<success_criteria>
- All 10 OWASP modules (A01-A10) extend SecurityModule base class
- Module category_id properties: owasp_a01 through owasp_a10
- Tier assignments: 5 MEDIUM (A02, A03, A05, A06, A08, A09, A10) and 3 DEEP (A01, A04, A07)
- A01 analyzes admin_panel, idor_patterns for broken access control
- A02 checks HTTPS, TLS version, hardcoded secrets
- A03 detects XSS, SQL injection, command injection patterns
- A04 detects mass assignment, race conditions, rate limiting
- A05 checks debug mode, default credentials, stack traces, CORS
- A06 detects outdated library versions (jQuery, Bootstrap, React, Angular)
- A07 checks password fields, session fixation, unprotected redirects
- A08 detects insecure deserialization, missing SRI, CDN integrity
- A09 checks for sensitive data in console.log, missing audit trails
- A10 detects SSRF patterns: file://, localhost, cloud metadata
- All findings include cwe_id via CWEMapper mapping
- All modules importable and execute analyze() method
- Plan committed with atomic task commits
</success_criteria>

<output>
After completion, create `.planning/phases/10-cybersecurity-deep-dive/10-02-SUMMARY.md`
</output>
